DROP TABLE has_price_hpr;
DROP TABLE booking_bkg;
DROp TABLE customer_cst;
DROP TABLE type_price_tpr;
DROP TABLE show_shw;
DROP TABLE type_show_tsh;

CREATE TABLE show_shw(
     shw_id NUMBER(20) GENERATED BY DEFAULT AS IDENTITY,
     shw_title VARCHAR2(50),
     shw_desc VARCHAR2(255),
     shw_duration NUMBER(3),
     shw_tsh_id NUMBER(20),
     shw_date DATE CONSTRAINT un_shw_date UNIQUE,
	   CONSTRAINT pk_shw PRIMARY KEY(shw_id));

CREATE TABLE customer_cst(
     cst_id NUMBER(20) GENERATED BY DEFAULT AS IDENTITY,
     cst_email VARCHAR2(25) CONSTRAINT nn_clt_mel NOT NULL CONSTRAINT un_clt_mel UNIQUE,
     cst_last_name VARCHAR2(25),
     cst_first_name VARCHAR2(25),
     cst_phone CHAR(10),
	   CONSTRAINT pk_cst PRIMARY KEY(cst_id));

CREATE TABLE type_show_tsh(
     tsh_id NUMBER(20) GENERATED BY DEFAULT AS IDENTITY,
     tsh_name VARCHAR2(25) CONSTRAINT nn_tsh_name NOT NULL,
     CONSTRAINT pk_tsh PRIMARY KEY(tsh_id));

CREATE TABLE type_price_tpr(
     tpr_id NUMBER(20) GENERATED BY DEFAULT AS IDENTITY,
     tpr_name VARCHAR2(25) CONSTRAINT nn_tpr_name NOT NULL,
	   CONSTRAINT pk_tpr PRIMARY KEY(tpr_id));

CREATE TABLE has_price_hpr(
     hpr_shw_id NUMBER(20),
     hpr_tpr_id NUMBER(20) ,
     hpr_seat_price NUMBER(5,2),
     CONSTRAINT pk_hpr PRIMARY KEY(hpr_shw_id,hpr_tpr_id));

	   
CREATE TABLE booking_bkg(
     bkg_id NUMBER(20)GENERATED BY DEFAULT AS IDENTITY,
     bkg_date DATE DEFAULT CURRENT_DATE CONSTRAINT nn_bkg_date NOT NULL,
     bkg_total_seat NUMBER(1) CONSTRAINT ck_total_seat CHECK(bkg_total_seat > 0),
     bkg_cst_id NUMBER(20) CONSTRAINT nn_bkg_cst_id NOT NULL,
     bkg_shw_id NUMBER(20) CONSTRAINT nn_bkg_shw_id NOT NULL,
     bkg_tpr_id NUMBER(20)CONSTRAINT nn_bkg_tpr_id NOT NULL,
	   CONSTRAINT pk_bkg PRIMARY KEY(bkg_id));


ALTER TABLE show_shw ADD CONSTRAINT fk_shw_tsh_id FOREIGN KEY(shw_tsh_id) REFERENCES type_show_tsh(tsh_id);
ALTER TABLE has_price_hpr ADD CONSTRAINT fk_hpr_shw_id FOREIGN KEY(hpr_shw_id) REFERENCES SHOW_SHW(shw_id);
ALTER TABLE has_price_hpr ADD CONSTRAINT fk_hpr_tpr_id FOREIGN KEY(hpr_tpr_id) REFERENCES type_price_tpr(tpr_id);
ALTER TABLE booking_bkg ADD CONSTRAINT fk_bkg_cst_id FOREIGN KEY(bkg_cst_id) REFERENCES customer_cst(cst_id);
ALTER TABLE booking_bkg ADD CONSTRAINT fk_bkg_shw_id FOREIGN KEY(bkg_shw_id) REFERENCES show_shw(shw_id);
ALTER TABLE booking_bkg ADD CONSTRAINT fk_bkg_tpr_id FOREIGN KEY(bkg_tpr_id) REFERENCES type_price_tpr(tpr_id);


INSERT INTO type_show_tsh (tsh_ID, tsh_name) VALUES (1,'Theater');
INSERT INTO type_show_tsh (tsh_ID, tsh_name) VALUES (2, 'Dance');
INSERT INTO type_show_tsh (tsh_ID, tsh_name) VALUES (3, 'Music');
INSERT INTO type_show_tsh (tsh_ID, tsh_name) VALUES (4, 'Magic');
INSERT INTO type_show_tsh (tsh_ID, tsh_name) VALUES (5, 'Circus');
INSERT INTO type_show_tsh (tsh_ID, tsh_name) VALUES (6, 'Humor');
INSERT INTO type_show_tsh (tsh_ID, tsh_name) VALUES (7, 'Opera');


INSERT INTO SHOW_SHW (shw_ID, shw_title, shw_duration, shw_date, shw_tsh_ID) VALUES (10, 'CALACAS - ZINGARO', '90', TO_DATE('28/09/2021', 'DD/MM/YYYY'),  1);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_DESC, shw_duration, shw_date,shw_tsh_ID) VALUES (11, 'LUNA ROSSA', 'Mise en scene B. Lotti', '75', TO_DATE('29/09/2021', 'DD/MM/YYYY'), 1);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_DESC, shw_duration, shw_date,shw_tsh_ID) VALUES (12, 'LES AVEUGLES', 'Mise en scene D. Marleau', '90',  TO_DATE('01/10/2021', 'DD/MM/YYYY'), 1);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_DESC, shw_duration,shw_date, shw_tsh_ID) VALUES (13, 'OUT OF TIME', 'Choregraphie C. Dunne', '75', TO_DATE('02/10/2021', 'DD/MM/YYYY'), 2);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_DESC, shw_duration,shw_date, shw_tsh_ID) VALUES (14, 'FIORDALISI', 'Choregraphie R. Giordano', '90', TO_DATE('06/10/2021', 'DD/MM/YYYY'), 2);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_DESC, shw_duration,shw_date,shw_tsh_ID) VALUES (15, 'LE COMTE ORY', 'Ensemble Matheus', '120',TO_DATE('23/10/2021', 'DD/MM/YYYY'),  3);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_duration, shw_date,shw_tsh_ID) VALUES (16, 'MARTIALSOLAL TRIO', '90', TO_DATE('24/10/2021', 'DD/MM/YYYY'),3);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_duration, shw_date,shw_tsh_ID) VALUES (17, 'KAZUT DE TYR', '90', TO_DATE('04/10/2021', 'DD/MM/YYYY'), 3);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_DESC, shw_duration,shw_date,shw_tsh_ID) VALUES (18, 'LE SOIR DES MONSTRES', 'Etienne Saglio', '75', TO_DATE('15/01/2022', 'DD/MM/YYYY'), 4);
INSERT INTO SHOW_SHW (shw_ID, shw_title,  shw_DESC, shw_duration, shw_date,shw_tsh_ID) VALUES (19, 'PFFFFF !', 'Cie Akoreacro', '75',TO_DATE('12/10/2021', 'DD/MM/YYYY'),  4);
INSERT INTO SHOW_SHW (shw_ID, shw_title, shw_duration, shw_date,shw_tsh_ID) VALUES (20, 'SOPHIA ARAM', '75', TO_DATE('17/01/2022', 'DD/MM/YYYY'), 6);


INSERT INTO customer_cst (Cst_ID, cst_email, Cst_last_name, Cst_first_name, Cst_phone) VALUES (1, 'rnelson@machin.fr', 'NELSON', 'Ryan', '0683242254');
INSERT INTO customer_cst (Cst_ID, cst_email, Cst_last_name, Cst_first_name, Cst_phone) VALUES (2, 'barry.robichaux@truc.fr', 'ROBICHAUX', 'Barry', '0228794613');
INSERT INTO customer_cst (Cst_ID, cst_email, Cst_last_name, Cst_first_name, Cst_phone) VALUES (3, 'cjones@machin.fr', 'JONES', 'Chandi', '0659157846');
INSERT INTO customer_cst (Cst_ID, cst_email, Cst_last_name, Cst_phone) VALUES (4, 'djekeye@machin.fr', 'DJEKEYE', '0659157879');


INSERT INTO TYPE_PRICE_TPR(tpr_ID, tpr_name) VALUES (1, 'FULL RATE');
INSERT INTO TYPE_PRICE_TPR(tpr_ID, tpr_name) VALUES (2, 'SEASON TICKET');
INSERT INTO TYPE_PRICE_TPR(tpr_ID, tpr_name) VALUES (3, 'SEASON TICKET PLUS');

INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (10, 1, 55);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (10, 2, 45);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (10, 3, 30);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (11, 1, 60);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (12, 1, 62);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (13, 1, 78);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (14, 1, 75);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (15, 1, 58);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (15, 2, 46);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (15, 3, 31);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (16, 1, 61);

INSERT INTO BOOKING_BKG (bkg_ID, bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) VALUES (100, TO_DATE('19/09/2021', 'DD/MM/YYYY'), 2, 1, 10, 1);
INSERT INTO BOOKING_BKG (bkg_ID, bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID,bkg_tpr_ID) VALUES (101, TO_DATE('1/10/2021', 'DD/MM/YYYY'), 4, 3, 10, 2);
INSERT INTO BOOKING_BKG (bkg_ID, bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) VALUES (102, TO_DATE('28/08/2021', 'DD/MM/YYYY'), 1, 2, 14, 1);




ALTER TABLE show_shw MODIFY shw_id NUMBER(20) GENERATED ALWAYS AS IDENTITY START WITH 21;
ALTER TABLE booking_bkg MODIFY bkg_id NUMBER(20) GENERATED ALWAYS AS IDENTITY START WITH 103;
ALTER TABLE customer_cst MODIFY cst_id NUMBER(20) GENERATED ALWAYS AS IDENTITY START WITH 5;
ALTER TABLE type_show_tsh MODIFY tsh_id NUMBER(20) GENERATED ALWAYS AS IDENTITY START WITH 8;

INSERT INTO SHOW_SHW (shw_title, shw_desc, shw_duration, shw_date, shw_tsh_ID) VALUES ('LES FAUX BRITISH', 'Véritable triomphe au Royaume-Uni...', 100, TO_DATE('12/11/2021', 'DD/MM/YYYY'),  1);
INSERT INTO SHOW_SHW ( shw_title, shw_desc, shw_duration, shw_date,shw_tsh_ID) VALUES (UPPER('Le canard à l''orange'), 'Avec tout le talent qu''on lui connait, Nicolas Briançon s''empare brillamment de ce célèbre vaudeville britannique et le mijote à point !', 100, TO_DATE('29/10/2021', 'DD/MM/YYYY'), 1);  

INSERT INTO customer_cst (cst_email, cst_first_name, Cst_last_name) VALUES ('imartin567@voila.fr', 'Isabelle', 'MARTIN');

INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (22, 1, 40);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (22, 2, 35);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (22, 3, 20);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (21, 1, 45);
INSERT INTO has_price_hpr(hpr_shw_id, hpr_tpr_id, hpr_seat_price) VALUES (21, 2, 35);

INSERT INTO BOOKING_BKG ( bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) 
VALUES ( TO_DATE('10/10/2021', 'DD/MM/YYYY'), 1, 1, 21, 1);
INSERT INTO BOOKING_BKG ( bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) 
VALUES ( TO_DATE('28/09/2021', 'DD/MM/YYYY'), 2, 4, 22, 2);
INSERT INTO BOOKING_BKG ( bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) 
VALUES ( TO_DATE('30/09/2021', 'DD/MM/YYYY'), 2, 5, 22, 1);

INSERT INTO BOOKING_BKG ( bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) 
VALUES ( TO_DATE('30/09/2021', 'DD/MM/YYYY'), 2, 1, 15, 1);
INSERT INTO BOOKING_BKG ( bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) 
VALUES ( TO_DATE('30/10/2021', 'DD/MM/YYYY'), 1, 4, 21, 2);
INSERT INTO BOOKING_BKG ( bkg_DATE, bkg_total_seat, bkg_Cst_ID, bkg_shw_ID, bkg_tpr_ID) 
VALUES ( TO_DATE('30/11/2021', 'DD/MM/YYYY'), 3, 5, 20, 1);

COMMIT;

//DISPLAYING DATA
SELECT *
FROM show_shw;

SELECT *
FROM customer_cst;

SELECT *
FROM booking_bkg;

SELECT *
FROM type_show_tsh;

SELECT *
FROM type_price_tpr;

SELECT *
FROM has_price_hpr;

//ANSWERS
//1. List all shows
SELECT *
FROM show_shw;

//2. List all customers first and last names
SELECT CST_LAST_NAME, CST_FIRST_NAME
FROM customer_cst;

//3. List all bookings id, date and number of seats booked
SELECT BKG_ID, BKG_DATE, BKG_TOTAL_SEAT
FROM booking_bkg;

//4. Identify customer’s table primary key. List all values of this attribute, in descending order
SELECT CST_ID
FROM customer_cst
ORDER BY cst_id DESC;

//5. Identify the primary key of the booking table, and all columns of the booking table with a 
//   foreign key constraint. List those columns in ascending order of the booking identifier.
SELECT BKG_ID, BKG_CST_ID, BKG_SHW_ID, BKG_TPR_ID
FROM booking_bkg
ORDER BY BKG_ID;

//6. List customers with a NULL phone number
SELECT *
FROM customer_cst
where cst_phone IS NULL;

//7. List all prices sorted by show identifier
SELECT *
FROM has_price_hpr
ORDER BY hpr_shw_id;

//8. List bookings with the most recent bookings first
SELECT * 
FROM booking_bkg
ORDER by bkg_date DESC;

//9. List all show durations – with no duplicates
SELECT DISTINCT shw_duration
from show_shw

//11. List customers names in one output column (use the concatenation operator, the first name 
//with initial capital letter and the last name uppercase) and customers email. Place a space 
//character between first and last name. Use an alias to set the name of the column that outputs 
//the name
SELECT 'Name: ' || CST_FIRST_NAME || ' '|| (UPPER)CST_LAST_NAME || 'Email: ' || CST_EMAIL as CustomerInfo 
FROM customer_cst; 

//12. List shows with a duration greater or equal to 90 minutes or a not null description (shw_desc)
SELECT * 
FROM show_shw
WHERE shw_duration >= 90 OR shw_desc IS NOT NULL;

//13. Customers who have an email address at ‘machin.fr’
SELECT * 
FROM CUSTOMER_CST
WHERE CST_EMAIL LIKE '%machin.fr%';

//14. List all shows that have a title beginning with the uppercase letter L
SELECT *
FROM show_shw
WHERE shw_title LIKE 'L%';

//15. List all shows with the character ! as the last character in the title
SELECT *
FROM show_shw
WHERE shw_title LIKE '%!';

//16. List shows with a duration between 75 and 100 (use the between…AND operator)
SELECT * 
FROM show_shw
WHERE shw_duration BETWEEN 75 AND 100;

//17. Print the total number of bookings
SELECT COUNT(*)
FROM booking_bkg;

//18. Print the highest show duration
SELECT MAX(shw_duration)
FROM show_shw;

//19. Print the number of distinct values of booking dates
SELECT DISTINCT COUNT(bkg_date)
FROM booking_bkg

//20. Print the average show duration and round the value produced to 1 decimal 
SELECT ROUND(AVG(shw_duration), 1)
FROM show_shw;

//21. List the show title and date with the date format similar to 12 – June - 2022
SELECT shw_title, to_char(shw_date, 'dd-month-yyyy')
FROM show_shw;
